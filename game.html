<!DOCTYPE html>
<html>
<head>
    <title>Enhanced Platformer</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; } /* Sky Blue */
        canvas { display: block; margin: 50px auto; border: 2px solid black; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1000" height="600"></canvas>  <!-- Increased size -->
    <script>
        // --- Game Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game constants
        const GRAVITY = 0.5;
        const JUMP_POWER = -15;  // Increased jump power
        const MOVE_SPEED = 5;

        // Player state
        let player = {
            x: 50,
            y: 400,  // Adjusted starting position
            width: 40,
            height: 40,
            dx: 0,
            dy: 0,
            isJumping: false,
            color: 'red'
        };

        // Ground properties
        const ground = {
            y: canvas.height - 40,
            height: 40,
            color: '#228B22' // Forest Green
        };

        // Platforms (array of objects)
        const platforms = [
            { x: 200, y: 350, width: 150, height: 20, color: 'brown' },
            { x: 500, y: 280, width: 100, height: 20, color: 'brown' },
            { x: 700, y: 450, width: 150, height: 20, color: 'brown' }
        ];

        // End Level Goal
        const endGoal = {
            x: 850,
            y: 360,
            width: 30,
            height: 30,
            color: 'gold'
        };

        // --- Game Loop ---
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // --- Update Game State ---
        function update() {
            // Apply gravity
            player.dy += GRAVITY;
            player.y += player.dy;

            // Ground collision
            if (player.y + player.height > ground.y) {
                player.y = ground.y - player.height;
                player.dy = 0;
                player.isJumping = false;
            }

            // Platform collision
            platforms.forEach(platform => {
                if (
                    player.x + player.width > platform.x &&
                    player.x < platform.x + platform.width &&
                    player.y + player.height > platform.y &&
                    player.y + player.height < platform.y + platform.height &&
                    player.dy >= 0 // Only collide if falling onto the platform
                ) {
                    player.y = platform.y - player.height;
                    player.dy = 0;
                    player.isJumping = false;
                }
            });

            // Horizontal movement
            player.x += player.dx;

            // Keep player on screen horizontally
            if (player.x < 0) {
                player.x = 0;
            } else if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }

            // Check for reaching the end goal
            if (
                player.x + player.width > endGoal.x &&
                player.x < endGoal.x + endGoal.width &&
                player.y + player.height > endGoal.y &&
                player.y < endGoal.y + endGoal.height
            ) {
                alert("Congratulations! You reached the end!");
                // Reset the game or go to the next level here
                player.x = 50;
                player.y = 400;
            }
        }

        // --- Render Game Elements ---
        function render() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw sky
            ctx.fillStyle = '#87CEEB'; // Sky Blue
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw ground
            ctx.fillStyle = ground.color;
            ctx.fillRect(0, ground.y, canvas.width, ground.height);

            // Draw platforms
            platforms.forEach(platform => {
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            // Draw player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // Draw end goal
            ctx.fillStyle = endGoal.color;
            ctx.fillRect(endGoal.x, endGoal.y, endGoal.width, endGoal.height);
        }

        // --- Input Handling ---
        window.addEventListener('keydown', function(e) {
            if (e.code === 'ArrowLeft' || e.code === 'KeyA') {
                player.dx = -MOVE_SPEED;
            } else if (e.code === 'ArrowRight' || e.code === 'KeyD') {
                player.dx = MOVE_SPEED;
            } else if ((e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') && !player.isJumping) {
                player.dy = JUMP_POWER;
                player.isJumping = true;
            }
        });

        window.addEventListener('keyup', function(e) {
            if (e.code === 'ArrowLeft' || e.code === 'KeyA') {
                player.dx = 0;
            } else if (e.code === 'ArrowRight' || e.code === 'KeyD') {
                player.dx = 0;
            }
        });

        // --- Start the Game ---
        gameLoop();
    </script>
</body>
</html>
